generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Category {
  id      String    @id @default(uuid())
  name    String    @unique
  Product Product[]
}

model Product {
  id           String         @id @default(uuid())
  title        String
  description  String
  price        Float          @default(0)
  slug         String         @unique
  tags         String[]       @default([])
  gender       Gender
  sizes        Size[]         @default([])
  stock        Int            @default(0)
  views        Int            @default(0)
  categoryId   String
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  category     Category       @relation(fields: [categoryId], references: [id])
  ProductImage ProductImage[]

  @@index([gender])
  @@index([categoryId])
}

model ProductImage {
  id        Int     @id @default(autoincrement())
  url       String
  productId String
  product   Product @relation(fields: [productId], references: [id])
}

model User {
  id                  String               @id @default(uuid())
  name                String
  email               String               @unique
  password            String
  role                Role                 @default(USER)
  emailVerified       Boolean              @default(false)
  phone               String?
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
  passwordResetTokens PasswordResetToken[]
  addresses           Address[]
  orders              Order[]

  @@index([email])
}

model PasswordResetToken {
  id        String   @id @default(uuid())
  token     String   @unique
  userId    String
  expiresAt DateTime
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([token])
  @@index([userId])
}

enum Size {
  XS
  S
  M
  L
  XL
  XXL
  XXXL
}

enum Gender {
  men
  women
  kid
  unisex
}

enum Role {
  USER
  ADMIN
}

enum OrderStatus {
  PENDING
  CONFIRMED
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
}

model Address {
  id          String   @id @default(uuid())
  userId      String
  firstName   String
  lastName    String
  phone       String
  address     String
  city        String
  province    String
  postalCode  String
  country     String   @default("Costa Rica")
  isDefault  Boolean  @default(false)
  notes       String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  orders      Order[]

  @@index([userId])
}

model Order {
  id              String      @id @default(uuid())
  userId          String
  addressId       String
  orderNumber     String      @unique
  status          OrderStatus @default(PENDING)
  subtotal        Float
  tax             Float
  shipping        Float       @default(0)
  total           Float
  paymentMethod   String?
  paymentStatus   String?     @default("PENDING")
  notes           String?
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  user            User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  address         Address     @relation(fields: [addressId], references: [id])
  items           OrderItem[]

  @@index([userId])
  @@index([orderNumber])
  @@index([status])
  @@index([createdAt])
}

model OrderItem {
  id          String  @id @default(uuid())
  orderId     String
  productId   String
  productSlug String
  productTitle String
  productImage String
  price       Float
  quantity    Int
  size        Size
  subtotal    Float
  order       Order   @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@index([orderId])
  @@index([productId])
}
